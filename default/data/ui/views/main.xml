<form>
  <label>Main</label>
  <fieldset submitButton="false">
    <input type="time" token="field1">
      <label></label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="host" searchWhenChanged="true">
      <label>netflow collectors</label>
      <choice value="*">*</choice>
      <search>
        <query>index=p0f sourcetype=netflow | fields host|dedup host |table host</query>
        <earliest>-60m@m</earliest>
        <latest>now</latest>
      </search>
      <fieldForLabel>host</fieldForLabel>
      <fieldForValue>host</fieldForValue>
      <default>*</default>
    </input>
    <input type="dropdown" token="dvc_ip" searchWhenChanged="true">
      <label>netflow probes</label>
      <choice value="*">*</choice>
      <search>
        <query>index=p0f sourcetype=netflow | fields dvc_ip|dedup dvc_ip |table dvc_ip</query>
        <earliest>-60m@m</earliest>
        <latest>now</latest>
      </search>
      <fieldForLabel>dvc_ip</fieldForLabel>
      <fieldForValue>dvc_ip</fieldForValue>
      <default>*</default>
    </input>
  </fieldset>
  <row>
    <panel>
      <single>
        <title>Netflow collectors</title>
        <search>
          <query>index=p0f sourcetype=netflow | fields host |dedup host |stats count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="linkView">search</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">10</option>
      </single>
      <single>
        <title>Netflow probes</title>
        <search>
          <query>index=p0f sourcetype=netflow | fields dvc_ip|dedup dvc_ip |stats count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="linkView">search</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">10</option>
      </single>
    </panel>
    <panel>
      <table>
        <title>Netflow probe interface stats</title>
        <search>
          <query>index=p0f sourcetype=netflow dvc_ip=$dvc_ip$  |stats sum(bytes_in) as traffic, sparkline(sum(bytes_in)) as "traffic in time" by dvc_ip,src_interface|eval traffic=round(traffic/1024/1024,1) . " MB"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="wrap">undefined</option>
        <option name="rowNumbers">undefined</option>
        <option name="drilldown">row</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">10</option>
        <drilldown target="flow_details">
          <link>
            <![CDATA[
              /app/splunk_ta_netflow_logstash/flow_details?form.src_ip=*&form.dvc_ip=$row.dvc_ip$
            ]]>
          </link>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>Top src_ip by flow count</title>
        <search>
          <query>index=p0f sourcetype=netflow dvc_ip=$dvc_ip$  NOT (dest_port=2055 transport="udp") |eval tmp_src=(replace(src_ip,"\.","") . src_port . protocol_number) | eval tmp_dest=(replace(dest_ip,"\.","") . dest_port . protocol_number)
|eval commonid=tmp_src+tmp_dest |eventstats max(sequence) as maxsequence,sum(bytes_in) as bytes_total, sum(duration) as duration by commonid |eval bytes_in=bytes_total-bytes_in |eval bytes_out=bytes_total-bytes_in |where src_port&gt;dest_port |top src_ip</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <drilldown target="flow_details">
          <link>
            <![CDATA[
              /app/splunk_ta_netflow_logstash/flow_details?form.src_ip=$row.src_ip$&form.dvc_ip=$dvc_ip$
            ]]>
          </link>
        </drilldown>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Top src_ip by bytes_in</title>
        <search>
          <query>index=p0f sourcetype=netflow dvc_ip=$dvc_ip$ NOT (dest_port=2055 transport="udp") |eval tmp_src=(replace(src_ip,"\.","") . src_port . protocol_number) | eval tmp_dest=(replace(dest_ip,"\.","") . dest_port . protocol_number)
|eval commonid=tmp_src+tmp_dest |eventstats max(sequence) as maxsequence,sum(bytes_in) as bytes_total, sum(duration) as duration by commonid |eval bytes_in=bytes_total-bytes_in |eval bytes_out=bytes_total-bytes_in |where src_port&gt;dest_port
|stats sum(bytes_in) as sum by src_ip |sort - sum|head 10</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.axisY2.enabled">undefined</option>
        <drilldown target="flow_details">
          <link>
            <![CDATA[
              /app/splunk_ta_netflow_logstash/flow_details?form.src_ip=$row.src_ip$&form.dvc_ip=$dvc_ip$
            ]]>
          </link>
        </drilldown>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>Top flows by dest_port</title>
        <search>
          <query>index=p0f sourcetype=netflow (transport=tcp OR transport=udp) NOT (dest_port=2055 transport="udp") |eval tmp_src=(replace(src_ip,"\.","") . src_port . protocol_number) | eval tmp_dest=(replace(dest_ip,"\.","") . dest_port . protocol_number)
|eval commonid=tmp_src+tmp_dest |eventstats max(sequence) as maxsequence,sum(bytes_in) as bytes_total, sum(duration) as duration by commonid |eval bytes_in=bytes_total-bytes_in |eval bytes_out=bytes_total-bytes_in |where src_port&gt;dest_port | top dest_port showperc=f</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <drilldown target="flow_details">
          <link>
            <![CDATA[
              /app/splunk_ta_netflow_logstash/flow_details?form.src_ip=*&form.dest_port=$row.dest_port$&form.dvc_ip=$dvc_ip$
            ]]>
          </link>
        </drilldown>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Traffic totals by dest_port</title>
        <search>
          <query>index=p0f sourcetype=netflow (transport=tcp OR transport=udp)  NOT (dest_port=2055 transport="udp")
|eval tmp_src=(replace(src_ip,"\.","") . src_port . protocol_number) | eval tmp_dest=(replace(dest_ip,"\.","") . dest_port . protocol_number)
|eval commonid=tmp_src+tmp_dest |eventstats max(sequence) as maxsequence,sum(bytes_in) as bytes_total, sum(duration) as duration by commonid |eval bytes_in=bytes_total-bytes_in |eval bytes_out=bytes_total-bytes_in |where src_port&gt;dest_port
 | stats sum(bytes_in) as bytes_in by dest_port |eval MB=bytes_in/1024/1024 |table dest_port,MB|sort - MB |head 10</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <drilldown target="flow_details">
          <link>
            <![CDATA[
              /app/splunk_ta_netflow_logstash/flow_details?form.src_ip=83.149.69.224/27&form.dest_port=$row.dest_port$&form.dvc_ip=$dvc_ip$
            ]]>
          </link>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>traffic</title>
        <search>
          <query>index=p0f sourcetype=netflow |timechart span=5m sum(bytes_in) as bytes_in |eval mbps=((bytes_in/300)*8)/1024/1024|timechart avg(mbps) as mbps</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
    <panel>
      <table>
        <title>Cummulative TCP options seen during session</title>
        <search>
          <query>index=p0f sourcetype=netflow transport="tcp" |eval fin=tcp_flag_bitfield%2 |eval syn=floor(tcp_flag_bitfield/2)%2 |eval rst=floor(tcp_flag_bitfield/4)%2 |eval psh=floor(tcp_flag_bitfield/8)%2 |eval ack=floor(tcp_flag_bitfield/16)%2 |eval urg=floor(tcp_flag_bitfield/32)%2 |eval ecn=floor(tcp_flag_bitfield/64)%2 |eval cwr=floor(tcp_flag_bitfield/128)%2 |stats count by cwr,ecn,urg,ack,psh,rst,syn,fin |sort - count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>Closed port attempts (RST,ACK)</title>
        <search>
          <query>index=p0f sourcetype=netflow transport=tcp  |eval fin=tcp_flag_bitfield%2 |eval syn=floor(tcp_flag_bitfield/2)%2 |eval rst=floor(tcp_flag_bitfield/4)%2 |eval psh=floor(tcp_flag_bitfield/8)%2 |eval ack=floor(tcp_flag_bitfield/16)%2 |eval urg=floor(tcp_flag_bitfield/32)%2 |eval ecn=floor(tcp_flag_bitfield/64)%2 |eval cwr=floor(tcp_flag_bitfield/128)%2 |search rst=1 ack=1 syn=0|timechart count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>SYN's without ACK</title>
        <search>
          <query>index=p0f sourcetype=netflow transport=tcp  |eval fin=tcp_flag_bitfield%2 |eval syn=floor(tcp_flag_bitfield/2)%2 |eval rst=floor(tcp_flag_bitfield/4)%2 |eval psh=floor(tcp_flag_bitfield/8)%2 |eval ack=floor(tcp_flag_bitfield/16)%2 |eval urg=floor(tcp_flag_bitfield/32)%2 |eval ecn=floor(tcp_flag_bitfield/64)%2 |eval cwr=floor(tcp_flag_bitfield/128)%2  |search ack=0 syn=1|timechart count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">bottom</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>RST before end of session</title>
        <search>
          <query>index=p0f sourcetype=netflow transport=tcp  |eval fin=tcp_flag_bitfield%2 |eval syn=floor(tcp_flag_bitfield/2)%2 |eval rst=floor(tcp_flag_bitfield/4)%2 |eval psh=floor(tcp_flag_bitfield/8)%2 |eval ack=floor(tcp_flag_bitfield/16)%2 |eval urg=floor(tcp_flag_bitfield/32)%2 |eval ecn=floor(tcp_flag_bitfield/64)%2 |eval cwr=floor(tcp_flag_bitfield/128)%2 |search fin=0 rst=1 ack=1 syn=1|timechart count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>
</form>